(s=>{function e(){let o=(()=>{let o,c;var e={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(o in e)if(o in document){c=e[o];break}return function(e){return e&&document.addEventListener(c,e),!document[o]}})();o(function(){var e=(o=>{var c=document.cookie.split(";");for(let e=0;e<c.length;e++){var t=c[e].split("=");if(o===t[0].trim())return decodeURIComponent(t[1])}return null})(cartflows.active_checkout_cookie);e&&o()&&parseInt(cartflows.current_step)!==parseInt(e)&&(s(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s(document.body).trigger("update_checkout"),s(document).ajaxComplete(function(e,o){o.hasOwnProperty("responseJSON")&&(o=o.responseJSON.hasOwnProperty("fragments")?o.responseJSON.fragments:null)&&o.hasOwnProperty("wcf_cart_data")&&s(document.body).trigger("wcf_cart_data_restored",[o.wcf_cart_data])}))})}function o(){function i(e,o,c,t){let a=!1;""===e||"select"===t&&" "===e?o.hasClass("validate-required")&&(c.addClass("field-required"),a=!0):c.removeClass("field-required"),[t=!1,e,o]=[a,o,c],e.find(".wcf-field-required-error").remove(),t&&"yes"===cartflows.field_validation.is_enabled?(t=e.find("label").text(),o.after('<span class="wcf-field-required-error">'+t.replace(/\*/g,"").trim()+" "+cartflows.field_validation.error_msg+"</span>")):e.find(".wcf-field-required-error").remove()}var e=(o=s("form.woocommerce-checkout")).find("input, textarea"),o=o.find("select");e.on("blur",function(){var e,o=s(this),c=o.attr("type"),t=o.closest("p.form-row"),a=o.val();i(a,t,o,c),"number"===c&&(c=o.attr("min"),e=o.attr("max"),a=Number(a),t=t,o=o,c=Number(c),e=Number(e),""===a||a<c||e<a?(o.addClass("field-required"),o.after('<span class="wcf-field-required-error">'+cartflows.field_validation_msgs.number_field+c+" & "+e+"</span>")):(o.removeClass("field-required"),t.find(".wcf-field-required-error").remove()))}),o.on("blur",function(){var e=s(this).closest("p.form-row"),o=e.find(".select2-container--default"),c=e.find("select").val();i(c,e,o,"select")})}function c(){if("yes"!==cartflows.allow_persistence)return;if(!1===(()=>{var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})())return;var e="form.woocommerce-checkout #customer_details";let o={set(){let e=[];var o=s("form.woocommerce-checkout #customer_details");localStorage.removeItem("cartflows_checkout_form"),o.find("input[type=text], select, input[type=email], input[type=tel]").each(function(){e.push({name:this.name,value:this.value})}),c(),cartflows_checkout_form=JSON.stringify(e),localStorage.setItem("cartflows_checkout_form",cartflows_checkout_form)},get(){if(null!==localStorage.getItem("cartflows_checkout_form")){checkout_data=JSON.parse(localStorage.getItem("cartflows_checkout_form"));for(let e=0;e<checkout_data.length;e++)s("form.woocommerce-checkout [name="+checkout_data[e].name+"]").hasClass("select2-hidden-accessible")?s("form.woocommerce-checkout [name="+checkout_data[e].name+"]").selectWoo("val",[checkout_data[e].value]):s("form.woocommerce-checkout [name="+checkout_data[e].name+"]").val(checkout_data[e].value)}}},c=function(){var e=s("#billing_country").val(),o=s("#billing_address_1").val(),o=("NL"===e&&o&&(e=o.match(/^(\d+\S*)\s+(.+)$/))&&s("#billing_address_1").val(e[2]+" "+e[1]),s("#shipping_country").val()),e=s("#shipping_address_1").val();"NL"===o&&e&&(o=e.match(/^(\d+\S*)\s+(.+)$/))&&s("#shipping_address_1").val(o[2]+" "+o[1])};o.get(),s(e+" input, "+e+" select").on("change",function(){o.set()})}function t(){var e=s(".wcf-field-modern-label .woocommerce input, .wcf-field-modern-label .woocommerce select, .wcf-field-modern-label .woocommerce textarea");function o(e){var o=e.closest(".form-row"),c=e.is("select")||e.hasClass("select2-hidden-accessible")?e.find(":selected").text():e.val(),e=e.attr("type");""===c?o.removeClass("wcf-anim-label"):"hidden"===e?o.addClass("wcf-anim-hidden-label"):o.addClass("wcf-anim-label")}e.on("focusout input",function(){var e=s(this);o(e)}),s(e).each(function(){o(s(this))})}function a(){let e=s(".wcf-customer-info #billing_email").val();if(void 0!==e&&!cartflows.is_logged_in){if(""!==e){let o=s("#billing_email"),c=s(".wcf-email-validation-block"),t=s(".wcf-customer-login-section");if(c.remove(),i=e,!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i))return o.after('<span class="wcf-email-validation-block error">'+cartflows.email_validation_msgs.error_msg+"</span>"),t.removeClass("wcf-show");clearTimeout(n);let a=++l;n=setTimeout(function(){s.ajax({url:cartflows.ajax_url,type:"POST",data:{action:"wcf_check_email_exists",email_address:e,security:cartflows.check_email_exist_nonce},success(e){a===l&&(c.remove(),e.data&&e.data.success&&t.hasClass("wcf-show")?o.after('<span class="wcf-email-validation-block success">'+cartflows.email_validation_msgs.success_msg+"</span>"):e.data&&e.data.success?(e.data.is_login_allowed&&(o.after('<span class="wcf-email-validation-block success">'+cartflows.email_validation_msgs.success_msg+"</span>"),t.slideDown(400).addClass("wcf-show")),s(".wcf-create-account-section").hide(),s(".woocommerce-billing-fields__customer-login-label").show()):(t.slideUp(400).removeClass("wcf-show"),s(".wcf-create-account-section .create-account label.checkbox").show(),s(".wcf-create-account-section").show(),s(".woocommerce-billing-fields__customer-login-label").hide()))}})},300)}else s(".wcf-create-account-section").hide(),s(".wcf-customer-login-section").hide(),s(".wcf-email-validation-block").hide(),s(".woocommerce-billing-fields__customer-login-label").show();var i}}function i(){s("body").hasClass("cartflows-instant-checkout")&&s(".woocommerce-NoticeGroup").prependTo(".woocommerce-notices-wrapper")}let r={init(){s(document.body).on("click",".wcf-submit-coupon",this.submit_coupon),s(document.body).on("click",".wcf-remove-coupon",this.remove_coupon)},submit_coupon(e){e.preventDefault();let c=s(".wcf-custom-coupon-field"),o=s(this).closest(c),t=o.find(".wcf-coupon-code-input"),a=t.val();if(""===a)return t.addClass("field-required"),!1;t.removeClass("field-required");e=s(".wcf-embed-checkout-form #billing_email").val(),e={coupon_code:a,action:"wcf_woo_apply_coupon",security:cartflows.wcf_validate_coupon_nonce,billing_email:e};s.ajax({type:"POST",url:cartflows.ajax_url,data:e,success(e){var o=s(".wcf-custom-coupon-field");o.find(".woocommerce-error, .woocommerce-message").remove(),e&&!0===e.status?(s(document.body).trigger("update_checkout",{update_shipping_method:!1}),o.prepend(e.msg),c.addClass("wcf-coupon-applied")):e&&e.msg&&(o.prepend(e.msg),c.removeClass("wcf-coupon-applied"))}})},remove_coupon(e){e.preventDefault();e={coupon_code:s(this).attr("data-coupon"),action:"wcf_woo_remove_coupon",security:cartflows.wcf_validate_remove_coupon_nonce};s.ajax({type:"POST",url:cartflows.ajax_url,data:e,success(e){var o=s(".wcf-custom-coupon-field");o.find(".woocommerce-error, .woocommerce-message").hide(),s(".wcf-custom-coupon-field").removeClass("wcf-coupon-applied"),e&&(s(document.body).trigger("update_checkout",{update_shipping_method:!1}),o.prepend(e))}})}},l=0,n,d={init(){s(document.body).on("change",".wcf-checkout-file-input",this.handle_file_change)},handle_file_change(){let c=s(this),t=c.data("field-key"),a=s("#"+t),i=s("#"+t+"_error"),e=parseInt(c.data("max-size"))||5;if(i.empty(),this.files.length){var r=this.files[0];if(r.size>1024*e*1024)i.html("File size exceeds "+e+"MB limit."),c.val("");else{var o=r.name.split(".").pop().toLowerCase();let e=[];var l=(c.data("allowed-types")||"").toString();if((e=l?l.split(",").map(function(e){return e.trim().toLowerCase()}):["jpg","jpeg","png","webp","gif","pdf","mp3","m4a","wav","mp4","mov"]).length&&!e.includes(o))i.html("File type not allowed."),c.val("");else{let o=c.closest(".wcf-file-input-wrapper");o.addClass("wcf-file-uploading");l=new FormData;l.append("wcf_checkout_file",r),l.append("action","wcf_upload_checkout_file"),l.append("security",cartflows.wcf_file_upload_nonce),l.append("field_key",t),l.append("checkout_id",s("._wcf_checkout_id").val()||""),s.ajax({url:cartflows.ajax_url,type:"POST",data:l,contentType:!1,processData:!1,success(e){o.removeClass("wcf-file-uploading"),e.success&&e.data?a.val(e.data.url):(e=e.data&&e.data.error?e.data.error:"Upload failed",i.html(e),a.val(""),c.val(""))},error(){o.removeClass("wcf-file-uploading"),i.html("Upload failed. Please try again."),a.val(""),c.val("")}})}}}else a.val("")}};s(function(){c(),e(),o(),s(document.body).on("click","#wcf-embed-checkout-form .wcf-remove-product",function(e){e.preventDefault();let o=s(this).attr("data-id");e={p_key:s(this).attr("data-item-key"),p_id:o,action:"wcf_woo_remove_cart_product",security:cartflows.wcf_validate_remove_cart_product_nonce};s.ajax({type:"POST",url:cartflows.ajax_url,data:e,success(e){e=JSON.parse(e);!1===e.need_shipping&&s("#wcf-embed-checkout-form").find("#ship-to-different-address-checkbox").attr("checked",!1),void 0!==e.is_order_bump&&e.is_order_bump&&e.order_bump_id&&s('input[name="wcf-bump-order-cb-'+e.order_bump_id+'"]').prop("checked",!1),s("#wcf-embed-checkout-form").find(".woocommerce-notices-wrapper").first().html(e.msg),s(document).trigger("cartflows_remove_product",[o]),s("#wcf-embed-checkout-form").trigger("update_checkout")}})}),r.init(),jQuery.each(cartflows_checkout_optimized_fields,function(o,e){e.is_optimized&&(jQuery("#"+o).prepend('<a href="#" id="wcf_optimized_'+o+'">'+e.field_label+"</a>"),jQuery("#wcf_optimized_"+o).on("click",function(e){e.preventDefault(),jQuery("#"+o).removeClass("wcf-hide-field");e=o.replace(/_field/g,"");s("#"+e).trigger("focus"),jQuery(this).remove()}))}),s(document.body).on("click",".coupon-field .wcf-custom-coupon-field .wcf-optimized-coupon-field",function(e){e.preventDefault(),s(".wcf-custom-coupon-field").removeClass("wcf-hide-field"),s(this).remove()}),s(document.body).on("checkout_error updated_checkout",i),t(),cartflows.has_file_field&&d.init(),s(".wcf-customer-info #billing_email").on("input",function(){a()}),0<s(".wcf-customer-info #billing_email").length&&a(),s(".wcf-customer-login-url").on("click",function(e){e.preventDefault();e=s(".wcf-customer-login-section");e.hasClass("wcf-show")?(e.slideUp(400),e.removeClass("wcf-show")):(e.slideDown(400),e.addClass("wcf-show"))}),s(".wcf-customer-login-section__login-button").on("click",function(){var e=s("#billing_email").val(),o=s("#billing_password").val();s.ajax({url:cartflows.ajax_url,type:"POST",data:{action:"wcf_woocommerce_login",email:e,password:o,security:cartflows.woocommerce_login_nonce},success(e){e.data&&e.data.success?location.reload():s(".wcf-customer-info__notice").addClass("wcf-notice").html(e.data.error)}})})})})(jQuery);